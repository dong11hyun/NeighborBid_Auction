# 📘 설계문서 1: 포트폴리오 서버 아키텍처 개요

> **대상**: EC2를 처음 사용하는 주니어 개발자
> **목표**: 하나의 EC2 인스턴스에서 5개 프로젝트를 각각 Docker로 운영

---

## 1. 전체 구조 이해하기

### 🎯 우리가 만들 것

```
┌─────────────────────────────────────────────────────────────────┐
│                        AWS EC2 인스턴스                          │
│                    (Ubuntu 22.04 LTS 추천)                       │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                      Nginx (웹서버)                        │   │
│  │   - 포트 80 (HTTP) / 443 (HTTPS) 에서 요청 수신            │   │
│  │   - 도메인/경로에 따라 각 Docker 컨테이너로 요청 분배        │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Docker Compose                          │   │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │   │
│  │  │ Project 1   │ │ Project 2   │ │ Project 3   │  ...    │   │
│  │  │ Django      │ │ FastAPI     │ │ Django      │         │   │
│  │  │ PostgreSQL  │ │ OpenSearch  │ │ Kafka       │         │   │
│  │  │ :8001       │ │ :8002       │ │ :8003       │         │   │
│  │  └─────────────┘ └─────────────┘ └─────────────┘         │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 🔑 핵심 개념 설명

| 용어 | 쉬운 설명 |
|------|-----------|
| **EC2** | AWS에서 제공하는 가상 컴퓨터. 내 노트북처럼 사용 가능 |
| **Nginx** | 문지기 역할. 외부 요청을 받아서 적절한 Docker로 전달 |
| **Docker** | 각 프로젝트를 독립된 상자에 넣어 실행. 서로 충돌 없음 |
| **Docker Compose** | 여러 Docker 컨테이너를 한 번에 관리하는 도구 |
| **리버스 프록시** | Nginx가 요청을 받아 Docker로 전달하는 방식 |

---

## 2. 왜 이 구조인가?

### ✅ 장점

1. **격리성**: 각 프로젝트가 독립된 Docker에서 실행되어 서로 영향 없음
2. **비용 효율**: EC2 하나로 5개 프로젝트 운영 (월 약 $20~50)
3. **확장성**: 새 프로젝트 추가 시 Docker 컨테이너만 추가하면 됨
4. **실무 경험**: 실제 기업에서 사용하는 구조와 동일

### ⚠️ 주의할 점

1. **메모리 관리**: 5개 프로젝트 + 각종 DB 사용 시 최소 4GB RAM 권장
2. **포트 관리**: 각 프로젝트마다 다른 포트 사용 필수

---

## 3. EC2 인스턴스 사양 선택 가이드

### 💡 권장 사양

| 프로젝트 개수 | 권장 인스턴스 | RAM | 예상 월 비용 |
|--------------|---------------|-----|-------------|
| 1-2개 | t3.small | 2GB | ~$15 |
| 3-4개 | t3.medium | 4GB | ~$30 |
| **5개 (우리 케이스)** | **t3.large** | **8GB** | **~$60** |
| 5개 + 여유 | t3.xlarge | 16GB | ~$120 |

> ⚠️ **Kafka, OpenSearch 등 무거운 스택 사용 시 t3.large 이상 권장**

### 🔧 EC2 선택 시 체크리스트

- [ ] 리전: 서울 (ap-northeast-2) - 한국 사용자 대상
- [ ] OS: Ubuntu 22.04 LTS (안정적, 정보 많음)
- [ ] 스토리지: 최소 30GB (SSD gp3 권장)
- [ ] 보안 그룹: 80, 443, 22 포트 오픈

---

## 4. 도메인 & URL 설계 전략

### 방법 1: 경로(Path) 기반 라우팅 (추천 ⭐)

```
https://portfolio.example.com/           → 메인 포트폴리오 페이지
https://portfolio.example.com/project1/  → 프로젝트 1 (Django)
https://portfolio.example.com/project2/  → 프로젝트 2 (FastAPI)
https://portfolio.example.com/project3/  → 프로젝트 3
...
```

**장점**: 도메인 1개로 해결, SSL 인증서 1개만 필요

### 방법 2: 서브도메인 기반 라우팅

```
https://portfolio.example.com/      → 메인 포트폴리오 페이지
https://auction.example.com/        → 프로젝트 1 (경매 시스템)
https://chatbot.example.com/        → 프로젝트 2 (챗봇)
...
```

**장점**: 각 프로젝트가 완전히 독립적, URL이 깔끔함
**단점**: DNS 설정 추가 필요, 와일드카드 SSL 인증서 필요

---

## 5. 포트 할당 계획

```
┌────────────────────────────────────────────────────────────┐
│                    포트 할당 계획                           │
├─────────────────┬──────────────────────────────────────────┤
│ 외부 노출 포트   │ 용도                                     │
├─────────────────┼──────────────────────────────────────────┤
│ 80              │ HTTP 요청 수신 (Nginx)                   │
│ 443             │ HTTPS 요청 수신 (Nginx + SSL)            │
│ 22              │ SSH 접속                                 │
├─────────────────┼──────────────────────────────────────────┤
│ 내부 전용 포트   │ 용도                                     │
├─────────────────┼──────────────────────────────────────────┤
│ 8001            │ Project 1 - Django (NeighborBid)         │
│ 8002            │ Project 2 - FastAPI                      │
│ 8003            │ Project 3 - Django                       │
│ 8004            │ Project 4                                │
│ 8005            │ Project 5                                │
│ 5432            │ PostgreSQL (공유 또는 프로젝트별)          │
│ 9200            │ OpenSearch                               │
│ 9092            │ Kafka                                    │
└─────────────────┴──────────────────────────────────────────┘
```

---

## 6. 다음 문서 안내

| 문서 | 내용 |
|------|------|
| **📘 설계문서 2** | EC2 초기 설정 및 Docker 환경 구축 상세 가이드 |
| **📘 설계문서 3** | Nginx 리버스 프록시 설정 및 프로젝트별 Docker Compose 구성 |

---

## 📌 핵심 요약

```
1. EC2 인스턴스 1개 (t3.large 권장)
2. Nginx가 80/443 포트로 모든 요청 수신
3. 경로/서브도메인에 따라 각 Docker 컨테이너로 라우팅
4. 각 프로젝트는 독립된 Docker Compose 스택으로 실행
5. 내부 통신은 Docker 네트워크 사용
```
