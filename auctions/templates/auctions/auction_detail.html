{% extends 'auctions/base.html' %}
{% load static %} {% block content %}
<div class="container mt-4">
    
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-light p-2 rounded">
            <li class="breadcrumb-item"><a href="{% url 'auction_list' %}" class="text-decoration-none text-muted">í™ˆ</a></li>
            {% if auction.category %}
            <li class="breadcrumb-item"><a href="{% url 'auction_list' %}?category={{ auction.category.slug }}" class="text-decoration-none text-muted">{{ auction.category.name }}</a></li>
            {% endif %}
            <li class="breadcrumb-item active" aria-current="page">{{ auction.title }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-7">
            <div class="card border-0">
                {% if auction.image %}
                    <img src="{{ auction.image.url }}" class="img-fluid rounded shadow-sm border" alt="{{ auction.title }}" style="width: 100%; max-height: 500px; object-fit: contain; background-color: #f8f9fa;">
                {% else %}
                    <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" style="height: 400px;">ì´ë¯¸ì§€ ì—†ìŒ</div>
                {% endif %}
            </div>
            </div>

        <div class="col-md-5">
            <h2 class="fw-bold mb-3" style="font-size: 1.5rem;">{{ auction.title }}</h2>
            
            <div class="mb-4 pb-3 border-bottom">
                <span class="text-muted small">í˜„ì¬ê°€</span>
                <div class="d-flex align-items-end">
                    <h1 class="text-danger fw-bold mb-0 me-2">{{ auction.current_price }}<span class="fs-4">ì›</span></h1>
                    <span class="badge bg-secondary mb-2">{{ auction.bids.count }} ì…ì°°</span>
                </div>
                {% if auction.instant_price %}
                    <div class="text-muted small mt-1">å³ ì¦‰ì‹œêµ¬ë§¤ê°€: {{ auction.instant_price }}ì›</div>
                {% endif %}
            </div>

            <div class="d-grid gap-2 mb-4">
                {% if user.is_authenticated and user != auction.seller %}
                    <form method="post" class="d-grid">
                        {% csrf_token %}
                        <div class="input-group mb-2">
                            <input type="number" name="amount" class="form-control form-control-lg" 
                                   value="{{ auction.current_price|add:auction.bid_unit }}" 
                                   min="{{ auction.current_price|add:auction.bid_unit }}" 
                                   placeholder="ì…ì°°ê¸ˆì•¡">
                            <button class="btn btn-warning btn-lg fw-bold text-dark" type="submit" style="background-color: #fc0; border: none;">
                                ì…ì°°í•˜ê¸°
                            </button>
                        </div>
                    </form>
                    
                    {% if auction.instant_price %}
                    <form action="{% url 'auction_buy_now' auction.id %}" method="post" onsubmit="return confirm('ì¦‰ì‹œ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" class="d-grid">
                        {% csrf_token %}
                        <button class="btn btn-danger btn-lg fw-bold">âš¡ ì¦‰ì‹œ êµ¬ë§¤í•˜ê¸°</button>
                    </form>
                    {% endif %}

                    <a href="{% url 'toggle_watchlist' auction.id %}" class="btn btn-outline-secondary">
                        {% if request.user in auction.watchers.all %}â¤ï¸ ì°œ ì·¨ì†Œ{% else %}ğŸ¤ ê´€ì‹¬ìƒí’ˆ ë“±ë¡{% endif %}
                    </a>
                {% endif %}

                {% if user == auction.seller %}
                    <div class="alert alert-warning text-center">
                        <strong>ğŸ‘¨â€ğŸ’¼ íŒë§¤ì ë©”ë‰´</strong><br>
                        <form action="{% url 'auction_close' auction.id %}" method="post" class="mt-2">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-dark">ì¡°ê¸° ì¢…ë£Œí•˜ê¸°</button>
                        </form>
                    </div>
                {% endif %}
            </div>

            <div class="card mb-4 bg-light border-0">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-2">
                        <div class="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center me-3" style="width: 50px; height: 50px;">
                            ğŸ‘¤
                        </div>
                        <div>
                            <h6 class="mb-0 fw-bold"><a href="#" class="text-dark text-decoration-none">{{ auction.seller.nickname|default:auction.seller.username }}</a></h6>
                            <small class="text-muted">ì‹ ìš©ë„: {{ auction.seller.reputation_score }}ì </small>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>ğŸ† ìš°ìˆ˜ íŒë§¤ì</span>
                        <a href="{% url 'seller_profile' auction.seller.id %}" class="text-decoration-none">íŒë§¤ì ì •ë³´ ë³´ê¸° &gt;</a>
                    </div>
                </div>
            </div>

            <table class="table table-sm text-small">
                <tbody>
                    <tr>
                        <th class="text-muted w-25">ì¹´í…Œê³ ë¦¬</th>
                        <td>{{ auction.category.name|default:"ê¸°íƒ€" }}</td>
                    </tr>
                    <tr>
                        <th class="text-muted">ìƒíƒœ</th>
                        <td>{{ auction.get_condition_display }}</td>
                    </tr>
                    <tr>
                        <th class="text-muted">ì§€ì—­</th>
                        <td>{{ auction.region.name|default:"ì „êµ­" }}</td>
                    </tr>
                    <tr>
                        <th class="text-muted">ë°°ì†¡ë¹„</th>
                        <td>{{ auction.get_shipping_payer_display }}</td>
                    </tr>
                    <tr>
                        <th class="text-muted">ì¢…ë£Œì¼ì‹œ</th>
                        <td>{{ auction.end_time|date:"Y-m-d H:i" }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div> <hr class="my-5">

    <div class="row">
        <div class="col-md-8">
            <h4 class="fw-bold mb-4 bg-light p-2 border-start border-4 border-warning">ìƒí’ˆ ì„¤ëª…</h4>
            <div class="p-3 border rounded bg-white" style="min-height: 300px;">
                {{ auction.description|linebreaksbr }}
            </div>

            <h4 class="fw-bold mb-4 mt-5 bg-light p-2 border-start border-4 border-primary">ìƒí’ˆ ë¬¸ì˜</h4>
            <form action="{% url 'auction_comment' auction.id %}" method="post" class="mb-4">
                {% csrf_token %}
                <div class="input-group">
                    <textarea name="content" class="form-control" rows="2" placeholder="íŒë§¤ìì—ê²Œ ë¬¸ì˜í•˜ê¸°..." required></textarea>
                    <button class="btn btn-outline-dark" type="submit">ë“±ë¡</button>
                </div>
            </form>
            <div class="list-group list-group-flush">
                {% for comment in auction.comments.all %}
                    <div class="list-group-item px-0">
                        <div class="d-flex justify-content-between">
                            <strong>{{ comment.writer.nickname|default:comment.writer.username }}</strong>
                            <small class="text-muted">{{ comment.created_at|date:"m-d H:i" }}</small>
                        </div>
                        <p class="mb-0 text-muted">{{ comment.content }}</p>
                    </div>
                {% empty %}
                    <p class="text-muted small">ì•„ì§ ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <h5 class="fw-bold mb-3">ğŸª ì´ íŒë§¤ìì˜ ë‹¤ë¥¸ ìƒí’ˆ</h5>
            <div class="row g-2">
                {% for item in other_items %}
                <div class="col-6">
                    <div class="card h-100 border-0 shadow-sm">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.title }}" style="height: 100px; object-fit: cover;">
                        {% else %}
                            <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 100px;">No Image</div>
                        {% endif %}
                        <div class="card-body p-2">
                            <h6 class="card-title text-truncate small mb-1">{{ item.title }}</h6>
                            <p class="card-text text-danger fw-bold small">{{ item.current_price }}ì›</p>
                            <a href="{% url 'auction_detail' item.id %}" class="stretched-link"></a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-muted small">íŒë§¤ ì¤‘ì¸ ë‹¤ë¥¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="mb-5"></div>
</div>
{% endblock %}