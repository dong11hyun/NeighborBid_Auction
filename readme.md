# NeighborBid: ì‹¤ì‹œê°„ ë™ì‹œì„± ì œì–´ ê²½ë§¤ í”Œë«í¼

> **ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ëŠ” ê³ ì„±ëŠ¥ ì‹¤ì‹œê°„ ì…ì°° ì‹œìŠ¤í…œ**
> ì¹´ì¹´ì˜¤ë§µ ë°ì´í„°ì˜ ì •í™•ì„±ì„ ê³µê³µë°ì´í„°ì™€ êµì°¨ ê²€ì¦í•˜ì—¬ íì—… ë§¤ì¥ì„ ìë™ íƒì§€í•˜ëŠ” ì‹œìŠ¤í…œ

**í”„ë¡œì íŠ¸ ê¸°ê°„**: 2026.01 ~ (ì§„í–‰ì¤‘)

**ì°¸ì—¬ ì¸ì›**: 2ì¸ (ê¹€ë™í˜„, ì „ëŒ€ì›)

**ë°°í¬ ìƒíƒœ**: HTTP (IP ì ‘ì†), ë„ë©”ì¸ ë¯¸ì ìš©

---

## ğŸ¤” í”„ë¡œì íŠ¸ ê°œìš”

#### ë¬¸ì œ ì¸ì‹
- **ëˆì´ ì¦ë°œí•  ìˆ˜ ìˆë‹¤?**
    - ê²½ë§¤ ì‹œìŠ¤í…œ íŠ¹ì„±ìƒ ì¢…ë£Œ ì§ì „ **ë™ì‹œ ì…ì°°(Concurrent Bids)**ì´ í­ì£¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ê¸°ì¡´ ì‹œìŠ¤í…œì€ Aì™€ Bê°€ í†µì¥ ì”ê³  100ë§Œì›ì„ ê°€ì§€ê³  ë™ì‹œì— 100ë§Œì› ì…ì°°ì„ ì‹œë„í•˜ë©´, íƒ€ì´ë°ì— ë”°ë¼ ë‘˜ ë‹¤ ì…ì°°ì— ì„±ê³µí•˜ê³  ì”ê³ ëŠ” í•œ ë²ˆë§Œ ì°¨ê°ë˜ëŠ” **Critical Race Condition**ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
- **ì„œë²„ê°€ ë„ˆë¬´ ëŠë¦¬ë‹¤.**
    - ê²½ë§¤ ëª©ë¡ ì¡°íšŒ ì‹œ íŒë§¤ì ì •ë³´, ì¹´í…Œê³ ë¦¬, ì…ì°° ë‚´ì—­ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ **N+1 ì¿¼ë¦¬**ê°€ ë°œìƒí•˜ì—¬, 100ê°œì˜ ê²½ë§¤ ê¸€ ë¡œë”©ì— 300ë²ˆ ì´ìƒì˜ DB ì¡°íšŒê°€ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤.

#### í•´ê²° ë°©ì•ˆ
- **ë°ì´í„° ë¬´ê²°ì„± í™•ë³´**: **PostgreSQL**ì˜ **Row-Level Locking (`select_for_update`)**ì„ ë„ì…í•˜ì—¬ ì…ì°° íŠ¸ëœì­ì…˜ì„ ì›ìì (Atomic)ìœ¼ë¡œ ì²˜ë¦¬.
- **ì„±ëŠ¥ ìµœì í™”**: Django ORMì˜ **`select_related` / `prefetch_related`**ë¥¼ ì² ì €íˆ ì ìš©í•˜ì—¬ ì¿¼ë¦¬ ìˆ˜ë¥¼ 98% ê°ì†Œ.
- **ì‹¤ì‹œê°„ì„±**: **Redis**ì™€ **Django Channels**ë¥¼ í™œìš©í•œ WebSocket í†µì‹ ìœ¼ë¡œ ì…ì°° í˜„í™©ì„ 0.1ì´ˆ ë‚´ ì „íŒŒ.

#### ì„±ê³¼
| í•­ëª© | ìˆ˜ì¹˜ | ë¹„ê³  |
|------|------|------|
| **ë™ì‹œ ì…ì°° ë°ì´í„° ì˜¤ì°¨** | **0%** | 100ëª… ë™ì‹œ ì…ì°° í…ŒìŠ¤íŠ¸ (JMeter) |
| **API ì‘ë‹µ ì†ë„** | í‰ê·  80ms | ì¿¼ë¦¬ ìµœì í™” ì „ 1200ms ëŒ€ë¹„ 15ë°° í–¥ìƒ |
| **ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ ìˆ˜** | **4íšŒ** | ìµœì í™” ì „ 300+íšŒ ëŒ€ë¹„ 98% ê°ì†Œ |

---

## ğŸ§ë¬¸ì œí•´ê²°ê³¼ì •

### 1. ë™ì‹œì„± ì´ìŠˆ â€” ëˆì´ ì¦ë°œí•œë‹¤? (Race Condition)

**ë¬¸ì œ**: 
SQLite ê¸°ë°˜ì˜ ê°œë°œ í™˜ê²½ì—ì„œëŠ” íŒŒì¼ ì „ì²´ì— ë½(File Lock)ì´ ê±¸ë ¤ ë™ì‹œì„± ë¬¸ì œë¥¼ ì²´ê°í•˜ê¸° ì–´ë ¤ì› ìœ¼ë‚˜, í”„ë¡œë•ì…˜ í™˜ê²½ì„ ê°€ì •í•œ í…ŒìŠ¤íŠ¸ì—ì„œ ì¹˜ëª…ì ì¸ ê²°í•¨ ë°œê²¬.
```python
# ê¸°ì¡´ ì½”ë“œ (ë¬¸ì œ ë°œìƒ)
wallet = Wallet.objects.get(user=user)
wallet.balance -= amount
wallet.save()
# Aì™€ Bê°€ ë™ì‹œì— ì´ ë¼ì¸ì„ ì‹¤í–‰í•˜ë©´, ë‘˜ ë‹¤ ê°™ì€ ì”ì•¡ì„ ì½ì–´ì„œ ë®ì–´ì”Œì›€
```

**ê²°ê³¼**:
- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ **PostgreSQL 15**ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜.
- `select_for_update()` ë¹„ê´€ì  ë½(Pessimistic Lock) ì ìš©.

```python
# ê°œì„  ì½”ë“œ
with transaction.atomic():
    # í•´ë‹¹ Rowë¥¼ íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œê¹Œì§€ ì ê¸ˆ (Wait)
    wallet = Wallet.objects.select_for_update().get(user=user)
    wallet.balance -= amount
    wallet.save()
```
ì´í›„ 100ê±´ì˜ ë™ì‹œ ì…ì°° ì‹œë®¬ë ˆì´ì…˜ì—ì„œ **ë°ì´í„° ì˜¤ì°¨ 0ê±´** ë‹¬ì„±.

### 2. ì„±ëŠ¥ ë³‘ëª© â€” ì„œë²„ê°€ ë„ˆë¬´ ëŠë¦¬ë‹¤ (N+1 Problem)

**ë¬¸ì œ**: 
ê²½ë§¤ ë¦¬ìŠ¤íŠ¸ API í˜¸ì¶œ ì‹œ, ê° ê²½ë§¤ ì•„ì´í…œë§ˆë‹¤ ì—°ê²°ëœ `Seller`, `Category`, `Region` ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ê³„ì†í•´ì„œ DBë¥¼ ì¡°íšŒí•¨.

**ì½”ë“œ ê°œì„ **:
```python
# [BEFORE] 300+ Queries
auctions = Auction.objects.filter(status='ACTIVE')

# [AFTER] 4 Queries
auctions = Auction.objects.filter(status='ACTIVE').select_related(
    'seller', 'category', 'region'
).prefetch_related(
    'bids', 'watchers'
)
```

**ê²°ê³¼**:
- ë©”ì¸ í˜ì´ì§€ ë¡œë”© ì†ë„ **1.2ì´ˆ â†’ 0.08ì´ˆ** ë‹¨ì¶•.
- AWS Lightsail($10 í”Œëœ)ì˜ ì ì€ ë¦¬ì†ŒìŠ¤ë¡œë„ ì¾Œì í•œ ì„œë¹„ìŠ¤ ê°€ëŠ¥.

---

## ì¶”ê°€ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ìš”ì•½

| # | ë¬¸ì œ | ì›ì¸ | í•´ê²°ì±… |
|---|---|---|---|
| 1 | **AttributeError: 'winner'** | ì¦‰ì‹œ êµ¬ë§¤ ì‹œ ë‚™ì°°ì í•„ë“œ ë¶€ì¬ | Auction ëª¨ë¸ì— `winner` í•„ë“œ ì¶”ê°€ ë° ë§ˆì´ê·¸ë ˆì´ì…˜ |
| 2 | **WebSocket ëŠê¹€** | ë¹„ì •ìƒ ì¢…ë£Œ ì‹œ ë¦¬ì†ŒìŠ¤ ì ìœ  | `consumers.py`ì˜ `disconnect` ë©”ì„œë“œì— ì •êµí•œ ê·¸ë£¹ í•´ì œ ë¡œì§ ì¶”ê°€ |
| 3 | **ì´ë¯¸ì§€ ë³´ì•ˆ** | ì•…ì„± íŒŒì¼(.exe) ì—…ë¡œë“œ ê°€ëŠ¥ | `FileExtensionValidator`ë¡œ í™•ì¥ì ì œí•œ (jpg, png) ì ìš© |
| 4 | **DB í¬íŠ¸ ì¶©ëŒ** | ë¡œì»¬ Postgres(5432) ì ìœ  | Docker Compose í¬íŠ¸ ë§¤í•‘ì„ `5433:5432`ë¡œ ë³€ê²½í•˜ì—¬ ê³µì¡´ |
| 5 | **SECRET_KEY ë…¸ì¶œ** | settings.py í•˜ë“œì½”ë”© | `.env` íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ê³  `os.environ.get`ìœ¼ë¡œ ë¡œë“œ |

> ìƒì„¸ ê¸°ë¡: [zë°°í¬_ì „_í›„mdíŒŒì¼/1_1í™•ì¥ì„±.md](zë°°í¬_ì „_í›„mdíŒŒì¼/1_1í™•ì¥ì„±.md)

---

## ğŸ«¡ì‹¤í–‰ ê°€ì´ë“œ

### í™˜ê²½ ì„¤ì •

ì´ í”„ë¡œì íŠ¸ëŠ” **Docker** í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œì»¬ ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ì™„ë²½í•˜ê²Œ ì¼ì¹˜ì‹œì¼°ìŠµë‹ˆë‹¤.

```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡ 
git clone https://github.com/dong11hyun/NeighborBid_Auction.git
cd NeighborBid_Auction

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env ìƒì„±)
# ì•„ë˜ ë‚´ìš©ì„ .env íŒŒì¼ì— ì‘ì„±í•˜ì„¸ìš”
echo "DJANGO_SECRET_KEY=yoursecretkey" > .env
echo "DB_PASSWORD=securepass" >> .env
echo "ALLOWED_HOSTS=*" >> .env

# 3. Docker ì‹¤í–‰ (ë¹Œë“œ ë° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
docker-compose up -d --build

# 4. DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ê´€ë¦¬ì ìƒì„±
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

#### ì›¹ ì ‘ì†
- **Main**: `http://localhost:8000` (ì„œë²„ ë°°í¬ ì‹œ `http://<IP>:8000`)
- **Admin**: `http://localhost:8000/admin`

#### ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (Metabase + Sentry)
- **Metabase**: ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ (ì¼ì¼ ì…ì°° ìˆ˜, ë§¤ì¶œ í˜„í™©) ì‹œê°í™” ë„êµ¬. `http://localhost:3000` (Docker ì»¨í…Œì´ë„ˆ ì¶”ê°€ ì‹œ)
- **Sentry**: ì‹¤ì‹œê°„ ì—ëŸ¬ ì¶”ì . 500 ì—ëŸ¬ ë°œìƒ ì‹œ ì´ë©”ì¼ ì•Œë¦¼ ì—°ë™.

---

## ğŸ¤“ì„±ëŠ¥ ì§€í‘œ

| í•­ëª© | ìµœì í™” ì „ | ìµœì í™” í›„ | ê°œì„ ìœ¨ |
|------|-----------|-----------|--------|
| **ë©”ì¸ í˜ì´ì§€ ì¿¼ë¦¬ ìˆ˜** | 312íšŒ | 4íšŒ | **98.7%** |
| **API í‰ê·  ì‘ë‹µ ì‹œê°„** | 1200ms | 80ms | **15ë°°** |
| **ë™ì‹œ ì…ì°° ì„±ê³µë¥ ** | 85% (ë°ì´í„° ê¹¨ì§) | 100% (ì •í•©ì„± ë³´ì¥) | - |
| **ì„œë²„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | ì˜ˆì¸¡ ë¶ˆê°€ | 1.2GB (ì•ˆì •ì ) | - |

---

## ğŸ¥¸ ë²„ì „ë³„ ê°œë°œ íˆìŠ¤í† ë¦¬

##### v1.0 â€” MVP (Minimum Viable Product)
- Django ê¸°ë³¸ ê¸°ëŠ¥ì„ í™œìš©í•œ ê²½ë§¤ CRUD êµ¬í˜„.
- SQLite ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©.
- **í•œê³„**: ì‹¤ì‹œê°„ì„±ì´ ì—†ì–´ ì‚¬ìš©ìê°€ ìƒˆë¡œê³ ì¹¨ì„ í•´ì•¼ ì…ì°°ê°€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŒ.

##### v2.0 â€” Real-time & WebSocket
- **Redis + Django Channels** ë„ì….
- WebSocketì„ í†µí•´ ì…ì°° ë°œìƒ ì‹œ ì¦‰ì‹œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ê°€ê²© ê°±ì‹  ì „íŒŒ.
- 1:1 ì±„íŒ… ê¸°ëŠ¥ ì¶”ê°€ (íŒë§¤ì-ë‚™ì°°ì ê°„).

##### v3.0 â€” í™•ì¥ì„± ë° ì•ˆì •ì„± (í˜„ì¬ ë²„ì „)
- **PostgreSQL ë„ì…**: ë™ì‹œì„± ì œì–´ë¥¼ ìœ„í•œ DB êµì²´.
- **Dockerization**: ê°œë°œ/ìš´ì˜ í™˜ê²½ í†µì¼.
- **ë¹„ë™ê¸° í (Celery)**: ê²½ë§¤ ì¢…ë£Œ ìŠ¤ì¼€ì¤„ë§ ìë™í™”.
- **ë³´ì•ˆ ê°•í™”**: Nginx ë„ì… ë° í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬.

---

## ğŸ« ê¸°ìˆ  ìŠ¤íƒ & ì•„í‚¤í…ì²˜

| ë¶„ë¥˜ | ê¸°ìˆ  |
|------|------|
| **Language** | Python 3.11 |
| **Framework** | Django 5.2 (ASGI/WSGI) |
| **Real-time** | Django Channels, Daphne |
| **Database** | PostgreSQL 15, Redis (Cache/PubSub) |
| **Infra** | AWS Lightsail, Docker, Docker Compose |
| **Web Server** | Nginx |
| **Task Queue** | Celery, RabbitMQ/Redis |

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```text
[ì™¸ë¶€ ìš”ì²­]
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
User (Client) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Nginx (Web Server)â”‚
                                    â”‚ (Reverse Proxy)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                     â”‚                     â”‚
                       â–¼                     â–¼                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Django (WSGI)  â”‚    â”‚ Daphne (ASGI)  â”‚    â”‚  Celery Worker â”‚
              â”‚ (API/Admin)    â”‚    â”‚ (WebSocket)    â”‚    â”‚ (Async Task)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                      â”‚                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â–¼                       â–¼      â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL     â”‚      â”‚     Redis      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Celery Beat    â”‚
â”‚ (Main DB)      â”‚      â”‚ (Cache/PubSub) â”‚                     â”‚ (Scheduler)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í”„ë¡œì íŠ¸ êµ¬ì¡°

```text
NeighborBid/
â”œâ”€â”€ auctions/       # í•µì‹¬ ê²½ë§¤ ë¡œì§ (Models, Services)
â”œâ”€â”€ config/         # Django ì„¤ì • (Settings, ASGI, WSGI)
â”œâ”€â”€ docker/         # Docker ê´€ë ¨ ì„¤ì • (Nginx conf ë“±)
â”œâ”€â”€ users/          # ì‚¬ìš©ì ì¸ì¦ ë° í”„ë¡œí•„
â”œâ”€â”€ common/         # ì•Œë¦¼ ë“± ê³µí†µ ê¸°ëŠ¥
â”œâ”€â”€ manage.py       # Django ì§„ì…ì 
â”œâ”€â”€ docker-compose.yml       # ê°œë°œìš© ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ docker-compose.prod.yml  # ë°°í¬ìš© ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â””â”€â”€ requirements.txt         # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
```

---

ì´ í”„ë¡œì íŠ¸ëŠ” **MIT License**ì— ë”°ë¼ ë°°í¬ë©ë‹ˆë‹¤.
