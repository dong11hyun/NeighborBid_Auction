#  NeighborBid í”„ë¡œì íŠ¸ í™•ì¥ì„± ë¶„ì„ ë³´ê³ ì„œ

> **ëª©í‘œ**: ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ëŸ°ì¹­ì„ ìœ„í•œ ë°±ì—”ë“œ ë° ë³´ì•ˆ ê°œì„  ë°©í–¥ ì œì‹œ  
> **ë¶„ì„ ëŒ€ìƒ**: Django 5.2 + Channels + Redis + SQLite3 ê¸°ë°˜ ì‹¤ì‹œê°„ ê²½ë§¤ í”Œë«í¼  
> **ê¸°ì¤€**: ë™ì‹œ ì‚¬ìš©ì 10ëª… ê¸°ì¤€ í”„ë¡œë•ì…˜ í™˜ê²½ ìš´ì˜

---

##  ëª©ì°¨

| ë²ˆí˜¸ | í•­ëª© | ìƒíƒœ |
|:---:|------|:---:|
| 0 | [PostgreSQL ì í•©ì„± ë¶„ì„](#0-postgresql-ì í•©ì„±-ë¶„ì„) | âœ… |
| 1 | [ë°œê²¬ëœ ë²„ê·¸ ë° ìˆ˜ì • ì½”ë“œ](#1-ë°œê²¬ëœ-ë²„ê·¸-ë°-ìˆ˜ì •-ì½”ë“œ) | âš ï¸ |
| 2 | [ë¯¸ì™„ì„± ë¡œì§ ë° ê°œì„  ë°©í–¥](#2-ë¯¸ì™„ì„±-ë¡œì§-ë°-ê°œì„ -ë°©í–¥) | âš ï¸ |
| 3 | [10ëª… ë™ì‹œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë¬¸ì œì ](#3-10ëª…-ë™ì‹œ-ì‚¬ìš©ì-ì‹œë‚˜ë¦¬ì˜¤-ë¬¸ì œì ) | ğŸ”´ |
| 4 | [ë³´ì•ˆ ì·¨ì•½ì  ë° ê°œì„  ë°©ì•ˆ](#4-ë³´ì•ˆ-ì·¨ì•½ì -ë°-ê°œì„ -ë°©ì•ˆ) | ğŸ”´ |
| 5 | [ì¢…í•© ê°œì„  ë¡œë“œë§µ](#5-ì¢…í•©-ê°œì„ -ë¡œë“œë§µ) | ğŸ“‹ |

### ìƒíƒœ ë²”ë¡€
- âœ… ì–‘í˜¸ / ì í•©
- âš ï¸ ì£¼ì˜ í•„ìš” / ê°œì„  ê¶Œì¥
- ğŸ”´ ì¹˜ëª…ì  / ì¦‰ì‹œ ìˆ˜ì • í•„ìš”
- ğŸ“‹ ê³„íš

---

## 0. PostgreSQL ì í•©ì„± ë¶„ì„

###  ì§ˆë¬¸: PostgreSQLì´ ì†Œê·œëª¨ íŠ¸ë˜í”½ì„ ê°ë‹¹í•  ìˆ˜ ìˆëŠ”ê°€?

**ê²°ë¡ :  ë§¤ìš° ì í•©í•©ë‹ˆë‹¤.**

### 0.1 PostgreSQL vs SQLite3 ë¹„êµ

| í•­ëª© | SQLite3 (í˜„ì¬) | PostgreSQL (ì „í™˜ ì˜ˆì •) |
|------|:-------------:|:--------------------:|
| **ë™ì‹œ ì—°ê²° ìˆ˜** | ë‹¨ì¼ Writer Lock | 100+ ë™ì‹œ ì—°ê²° ì§€ì› |
| **ë™ì‹œì„± ì œì–´** | íŒŒì¼ ë ˆë²¨ Lock | Row ë ˆë²¨ Lock (MVCC) |
| **`SELECT FOR UPDATE`** | âš ï¸ ì œí•œì  ì§€ì› | âœ… ì™„ì „ ì§€ì› |
| **í™•ì¥ì„±** | ë‹¨ì¼ ì„œë²„ í•œì • | ìˆ˜í‰/ìˆ˜ì§ í™•ì¥ ê°€ëŠ¥ |
| **í”„ë¡œë•ì…˜ ì í•©ì„±** | ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© | í”„ë¡œë•ì…˜ í‘œì¤€ |

### 0.2 PostgreSQLì„ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œ ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ | ê·œëª¨ | ë¹„ê³  |
|--------|------|------|
| **Instagram** | 20ì–µ+ MAU | Django + PostgreSQL ì¡°í•© |
| **Spotify** | 5ì–µ+ MAU | ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ |
| **Reddit** | 5ì²œë§Œ+ DAU | ê³ íŠ¸ë˜í”½ ì»¤ë®¤ë‹ˆí‹° |
| **Disqus** | 17ì–µ í˜ì´ì§€ë·°/ì›” | Django ê¸°ë°˜ |
| **ë‹¹ê·¼ë§ˆì¼“** | 2ì²œë§Œ+ MAU | ì¤‘ê³ ê±°ë˜ í”Œë«í¼ |

### 0.3 ì†Œê·œëª¨ íŠ¸ë˜í”½ (10ëª… ë™ì‹œ ì‚¬ìš©ì) ê¸°ì¤€ PostgreSQL ì„±ëŠ¥

```
ğŸ“Š ì˜ˆìƒ ë¶€í•˜ ë¶„ì„

ë™ì‹œ ì‚¬ìš©ì: 10ëª…
ì´ˆë‹¹ ìš”ì²­ ìˆ˜ (ì¶”ì •): 5~20 RPS
DB ì—°ê²° í’€: 20ê°œë©´ ì¶©ë¶„
ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 512MB ~ 1GB

â†’ PostgreSQLì€ ìˆ˜ì²œ RPSë„ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë¯€ë¡œ ì—¬ìœ ë¡œìš´ ì„±ëŠ¥
â†’ AWS RDS t3.micro (ë¬´ë£Œ í‹°ì–´)ë¡œë„ ì¶©ë¶„íˆ ìš´ì˜ ê°€ëŠ¥
```

### 0.4 PostgreSQL ì „í™˜ ì‹œ í•„ìš”í•œ ë³€ê²½ì‚¬í•­

#### settings.py ìˆ˜ì •

```python
# config/settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': os.environ.get('DB_NAME', 'neighborbid'),
        'USER': os.environ.get('DB_USER', 'postgres'),
        'PASSWORD': os.environ.get('DB_PASSWORD'),
        'HOST': os.environ.get('DB_HOST', 'localhost'),
        'PORT': os.environ.get('DB_PORT', '5432'),
        # ì—°ê²° í’€ë§ì„ ìœ„í•œ ì˜µì…˜
        'CONN_MAX_AGE': 60,
        'OPTIONS': {
            'connect_timeout': 10,
        }
    }
}
```

#### docker-compose.yml ì¶”ê°€

```yaml
# docker-compose.ymlì— ì¶”ê°€
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: neighborbid
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
```

#### requirements.txt ì¶”ê°€

```
psycopg2-binary==2.9.9
# ë˜ëŠ” ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´
psycopg[binary]==3.1.17
```

> [!IMPORTANT]
> **PostgreSQL ì „í™˜ ì‹œ ì£¼ì˜ì‚¬í•­**
> - ê¸°ì¡´ SQLite3 ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš” (`dumpdata` â†’ `loaddata`)
> - `select_for_update()` ë™ì‘ì´ ì‹¤ì œ Row Lockìœ¼ë¡œ ë³€ê²½ë¨
> - ì¸ë±ìŠ¤ ìµœì í™” í•„ìš” (íŠ¹íˆ `current_price`, `status` í•„ë“œ)

---

## 1. ë°œê²¬ëœ ë²„ê·¸ ë° ìˆ˜ì • ì½”ë“œ

### ğŸ› Bug #1: `buy_now()` í•¨ìˆ˜ì˜ `winner` í•„ë“œ ì°¸ì¡° ì˜¤ë¥˜ (ì¹˜ëª…ì )

**ìœ„ì¹˜**: `auctions/services.py` Line 223

**ë¬¸ì œ**: Auction ëª¨ë¸ì— `winner` í•„ë“œê°€ ì—†ëŠ”ë° ì°¸ì¡°í•˜ê³  ìˆìŒ

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ (ë²„ê·¸)
auction.winner = buyer  # âŒ AttributeError ë°œìƒ!
auction.status = 'ENDED'
auction.save()
```

**ì›ì¸ ë¶„ì„**:
- `Auction` ëª¨ë¸ì— `winner` í•„ë“œê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•ŠìŒ
- ì´ë¡œ ì¸í•´ ì¦‰ì‹œ êµ¬ë§¤ ì‹œ `AttributeError` ì˜ˆì™¸ ë°œìƒ

**ìˆ˜ì • ì½”ë“œ**:

```python
# âœ… ìˆ˜ì • ë°©ë²• 1: winner í•„ë“œ ì¶”ê°€ í›„ ì‚¬ìš©
# auctions/models.pyì˜ Auction í´ë˜ìŠ¤ì— ì¶”ê°€
winner = models.ForeignKey(
    settings.AUTH_USER_MODEL, 
    on_delete=models.SET_NULL, 
    null=True, 
    blank=True, 
    related_name='won_auctions'
)

# âœ… ìˆ˜ì • ë°©ë²• 2: í•„ë“œ ë¯¸ì¶”ê°€ì‹œ í•´ë‹¹ ë¼ì¸ ì œê±°
# auctions/services.py Line 223 ì£¼ì„ ì²˜ë¦¬ ë˜ëŠ” ì‚­ì œ
# auction.winner = buyer  # ì‚­ì œ
auction.status = 'ENDED'
auction.save()
```

---

### ğŸ› Bug #2: `charge_wallet()` íŠ¸ëœì­ì…˜ ë¯¸ì ìš© (ì¤‘ìš”)

**ìœ„ì¹˜**: `auctions/views.py` Line 147-164

**ë¬¸ì œ**: ì¶©ì „ ë¡œì§ì— íŠ¸ëœì­ì…˜ì´ ì—†ì–´ ì¶©ì „ ì¤‘ ì˜¤ë¥˜ ì‹œ ë°ì´í„° ë¶ˆì¼ì¹˜ ê°€ëŠ¥

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ (ë²„ê·¸)
@login_required
def charge_wallet(request):
    if request.method == 'POST':
        amount = int(request.POST.get('amount', 0))
        if amount > 0:
            wallet = Wallet.objects.get(user=request.user)  # âŒ select_for_update ì—†ìŒ
            wallet.balance += amount
            wallet.save()
            
            Transaction.objects.create(...)  # âŒ ì—¬ê¸°ì„œ ì˜¤ë¥˜ë‚˜ë©´ balanceë§Œ ì˜¬ë¼ê°
```

**ìˆ˜ì • ì½”ë“œ**:

```python
# âœ… ìˆ˜ì •ëœ ì½”ë“œ
from django.db import transaction

@login_required
def charge_wallet(request):
    if request.method == 'POST':
        amount = int(request.POST.get('amount', 0))
        
        # ê¸ˆì•¡ ê²€ì¦ ê°•í™”
        if amount <= 0 or amount > 10_000_000:  # ìµœëŒ€ 1ì²œë§Œì› ì œí•œ
            messages.error(request, "ìœ íš¨í•˜ì§€ ì•Šì€ ì¶©ì „ ê¸ˆì•¡ì…ë‹ˆë‹¤.")
            return redirect('mypage')
            
        try:
            with transaction.atomic():
                wallet = Wallet.objects.select_for_update().get(user=request.user)
                wallet.balance += amount
                wallet.save()
                
                Transaction.objects.create(
                    wallet=wallet,
                    amount=amount,
                    transaction_type='DEPOSIT',
                    description='ë§ˆì´í˜ì´ì§€ì—ì„œ ì¶©ì „'
                )
            messages.success(request, f"{amount:,}ì›ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’µ")
        except Exception as e:
            messages.error(request, "ì¶©ì „ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
            
    return redirect('mypage')
```

---

### ğŸ› Bug #3: `auction_detail()` ì…ë ¥ê°’ ê²€ì¦ ë¶€ì¬ (ë³´ì•ˆ)

**ìœ„ì¹˜**: `auctions/views.py` Line 114

**ë¬¸ì œ**: POST ìš”ì²­ì˜ `amount` ê°’ì— ëŒ€í•œ ê²€ì¦ì´ ì—†ìŒ

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ (ë²„ê·¸)
amount = int(request.POST.get('amount'))  # âŒ Noneì´ë©´ TypeError, ìŒìˆ˜ë„ í—ˆìš©
```

**ìˆ˜ì • ì½”ë“œ**:

```python
# âœ… ìˆ˜ì •ëœ ì½”ë“œ
try:
    amount = int(request.POST.get('amount', 0))
    if amount <= 0:
        raise ValueError("ì…ì°° ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.")
except (ValueError, TypeError) as e:
    messages.error(request, "ìœ íš¨í•˜ì§€ ì•Šì€ ì…ì°° ê¸ˆì•¡ì…ë‹ˆë‹¤.")
    return redirect('auction_detail', auction_id=auction.id)
```

---

### ğŸ› Bug #4: `on_commit` í´ë¡œì € ë³€ìˆ˜ ìº¡ì²˜ ë¬¸ì œ (ì ì¬ì )

**ìœ„ì¹˜**: `auctions/services.py` Line 150-165

**ë¬¸ì œ**: `instant_price_val` ë³€ìˆ˜ê°€ í´ë¡œì €ì—ì„œ ì˜¬ë°”ë¥´ê²Œ ìº¡ì²˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ (ì ì¬ì  ë²„ê·¸)
def send_sold_out_notification():
    # instant_price_valì´ ì •ì˜ë˜ê¸° ì „ì— í•¨ìˆ˜ê°€ ì •ì˜ë¨ âŒ
    async_to_sync(channel_layer.group_send)(
        f'auction_{auction_id}',
        {
            'amount': instant_price_val,  # ì •ì˜ ì „ ì°¸ì¡° ê°€ëŠ¥ì„±
            ...
        }
    )
```

**ìˆ˜ì • ì½”ë“œ**:

```python
# âœ… ìˆ˜ì •ëœ ì½”ë“œ - í•¨ìˆ˜ë¥¼ atomic ë¸”ë¡ ì•ˆì—ì„œ ì •ì˜
def buy_now(auction_id, buyer):
    with transaction.atomic():
        auction = Auction.objects.select_for_update().get(id=auction_id)
        instant_price_val = auction.instant_price  # ë¨¼ì € ê°’ ìº¡ì²˜
        
        # í•¨ìˆ˜ ì •ì˜ë¥¼ ê°’ ì¶”ì¶œ í›„ë¡œ ì´ë™
        def send_sold_out_notification():
            channel_layer = get_channel_layer()
            async_to_sync(channel_layer.group_send)(
                f'auction_{auction_id}',
                {
                    'type': 'auction_end_notification',
                    'bidder': buyer.username,
                    'amount': instant_price_val,
                    'msg': f"ğŸ“¢ {buyer.username}ë‹˜ì´ {instant_price_val:,}ì›ì— ì¦‰ì‹œ êµ¬ë§¤!"
                }
            )
        
        # ... ë‚˜ë¨¸ì§€ ë¡œì§ ...
        transaction.on_commit(send_sold_out_notification)
```

---

## 2. ë¯¸ì™„ì„± ë¡œì§ ë° ê°œì„  ë°©í–¥

### ğŸ“‹ Incomplete #1: ê²½ë§¤ ìë™ ì¢…ë£Œ ìŠ¤ì¼€ì¤„ëŸ¬ ë¯¸êµ¬í˜„

**ìœ„ì¹˜**: ì‹œìŠ¤í…œ ì „ë°˜

**í˜„ì¬ ìƒíƒœ**: ê²½ë§¤ ì¢…ë£Œ ì‹œê°„(`end_time`)ì´ ì§€ë‚˜ë„ ìë™ìœ¼ë¡œ ìƒíƒœê°€ ë³€ê²½ë˜ì§€ ì•ŠìŒ

**ë¬¸ì œì **:
- íŒë§¤ìê°€ ìˆ˜ë™ìœ¼ë¡œ `close_auction`ì„ í˜¸ì¶œí•´ì•¼ ì¢…ë£Œë¨
- ì¢…ë£Œ ì‹œê°„ì´ ì§€ë‚œ ê²½ë§¤ì— ê³„ì† ì…ì°° ê°€ëŠ¥ (ë¡œì§ì—ì„œ ì²´í¬ëŠ” í•˜ì§€ë§Œ UX ë¶ˆëŸ‰)

**êµ¬í˜„ ë°©í–¥**:

```python
# ë°©ë²• 1: Celery Beatë¥¼ ì‚¬ìš©í•œ ì£¼ê¸°ì  íƒœìŠ¤í¬
# tasks.py (ì‹ ê·œ íŒŒì¼)

from celery import shared_task
from django.utils import timezone
from auctions.models import Auction
from auctions.services import determine_winner

@shared_task
def check_expired_auctions():
    """ë§¤ ë¶„ë§ˆë‹¤ ì¢…ë£Œ ì‹œê°„ì´ ì§€ë‚œ ê²½ë§¤ë¥¼ ì°¾ì•„ ì²˜ë¦¬"""
    expired_auctions = Auction.objects.filter(
        status='ACTIVE',
        end_time__lt=timezone.now()
    )
    
    for auction in expired_auctions:
        try:
            determine_winner(auction.id)
        except Exception as e:
            # ë¡œê¹… ì²˜ë¦¬
            pass
```

```python
# celery.py (ì‹ ê·œ íŒŒì¼)

from celery import Celery
from celery.schedules import crontab

app = Celery('neighborbid')
app.config_from_object('django.conf:settings', namespace='CELERY')

app.conf.beat_schedule = {
    'check-expired-auctions': {
        'task': 'auctions.tasks.check_expired_auctions',
        'schedule': 60.0,  # ë§¤ 60ì´ˆë§ˆë‹¤
    },
}
```

---

### ğŸ“‹ Incomplete #2: ì•Œë¦¼(Notification) ê¸°ëŠ¥ ë¯¸ì—°ë™

**ìœ„ì¹˜**: `common/models.py` Line 27-47

**í˜„ì¬ ìƒíƒœ**: `Notification` ëª¨ë¸ì€ ì •ì˜ë˜ì–´ ìˆìœ¼ë‚˜ ì‹¤ì œ ìƒì„± ë¡œì§ì´ ì—†ìŒ

**êµ¬í˜„ ë°©í–¥**:

```python
# auctions/services.pyì— ì¶”ê°€

from common.models import Notification

def place_bid(auction_id, user, amount):
    with transaction.atomic():
        # ... ê¸°ì¡´ ì…ì°° ë¡œì§ ...
        
        # ì´ì „ ìµœê³  ì…ì°°ìì—ê²Œ ì•Œë¦¼ ì „ì†¡
        if last_bid and last_bid.bidder != user:
            def send_outbid_notification():
                Notification.objects.create(
                    recipient=last_bid.bidder,
                    message=f"[{auction.title}] ê²½ë§¤ì—ì„œ ìƒìœ„ ì…ì°°ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (í˜„ì¬ê°€: {amount:,}ì›)",
                    link=f"/auction/{auction_id}/"
                )
            transaction.on_commit(send_outbid_notification)
        
        # íŒë§¤ìì—ê²Œ ì•Œë¦¼
        def notify_seller():
            Notification.objects.create(
                recipient=auction.seller,
                message=f"[{auction.title}]ì— ìƒˆ ì…ì°°! {user.username}ë‹˜ì´ {amount:,}ì›ì— ì…ì°°",
                link=f"/auction/{auction_id}/"
            )
        transaction.on_commit(notify_seller)
```

---

### ğŸ“‹ Incomplete #3: ì…ì°° ë‹¨ìœ„(bid_unit) ê²€ì¦ ë¡œì§ ë¯¸í¡

**ìœ„ì¹˜**: `auctions/services.py` Line 26-33

**í˜„ì¬ ìƒíƒœ**: ì…ì°° ê¸ˆì•¡ì´ `bid_unit`ì˜ ë°°ìˆ˜ì¸ì§€ ê²€ì¦í•˜ì§€ ì•ŠìŒ

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
min_bid_price = auction.current_price + auction.bid_unit
if amount < min_bid_price:
    raise ValueError(f"ìµœì†Œ {min_bid_price}ì› ì´ìƒ ì…ì°°í•´ì•¼ í•©ë‹ˆë‹¤.")
# âŒ 1000ì› ë‹¨ìœ„ì¸ë° 1001ì› ì…ì°° ê°€ëŠ¥
```

**ìˆ˜ì • ì½”ë“œ**:

```python
# âœ… ê°œì„ ëœ ì½”ë“œ
min_bid_price = auction.current_price + auction.bid_unit if auction.current_price > 0 else auction.start_price

if amount < min_bid_price:
    raise ValueError(f"ìµœì†Œ {min_bid_price:,}ì› ì´ìƒ ì…ì°°í•´ì•¼ í•©ë‹ˆë‹¤.")

# ì…ì°° ë‹¨ìœ„ ë°°ìˆ˜ ê²€ì¦
if auction.bid_unit > 0 and amount % auction.bid_unit != 0:
    raise ValueError(f"ì…ì°° ê¸ˆì•¡ì€ {auction.bid_unit:,}ì› ë‹¨ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.")
```

---

### ğŸ“‹ Incomplete #4: ë¦¬ë·° ì‹œìŠ¤í…œì˜ ë‚™ì°°ì íŒë³„ ë¶ˆì™„ì „

**ìœ„ì¹˜**: `users/views.py` Line 54-64

**í˜„ì¬ ìƒíƒœ**: ì…ì°° ê¸°ë¡ìœ¼ë¡œ ë‚™ì°°ìë¥¼ ì¶”ì •í•˜ë‚˜, ì¦‰ì‹œ êµ¬ë§¤ìëŠ” ì²˜ë¦¬ ì•ˆ ë¨

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
last_bid = auction.bids.order_by('-amount').first()
if not last_bid or last_bid.bidder != request.user:
    messages.error(request, "ë‚™ì°°ìë§Œ í›„ê¸°ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
# âŒ ì¦‰ì‹œ êµ¬ë§¤í•œ ì‚¬ëŒì€ ë¦¬ë·° ì‘ì„± ë¶ˆê°€
```

**ìˆ˜ì • ë°©í–¥**:

```python
# âœ… ê°œì„  ë°©í–¥ (winner í•„ë“œ ì¶”ê°€ ì „ì œ)

# 1. Auction ëª¨ë¸ì— winner í•„ë“œ ì¶”ê°€
# 2. ì¦‰ì‹œ êµ¬ë§¤, ë‚™ì°° í™•ì • ì‹œ winner í•„ë“œ ì„¤ì •
# 3. ë¦¬ë·° ì‘ì„± ê¶Œí•œ ê²€ì‚¬ ìˆ˜ì •

def create_review(request, auction_id):
    auction = get_object_or_404(Auction, id=auction_id)
    
    # winner í•„ë“œ ì‚¬ìš© (ì—†ìœ¼ë©´ ì…ì°° ê¸°ë¡ìœ¼ë¡œ í´ë°±)
    is_winner = False
    if hasattr(auction, 'winner') and auction.winner:
        is_winner = (auction.winner == request.user)
    else:
        last_bid = auction.bids.order_by('-amount').first()
        is_winner = last_bid and last_bid.bidder == request.user
    
    if not is_winner:
        messages.error(request, "ë‚™ì°°ì/êµ¬ë§¤ìë§Œ í›„ê¸°ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        return redirect('auction_detail', auction_id=auction.id)
```

---

## 3. 10ëª… ë™ì‹œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë¬¸ì œì 

> [!CAUTION]
> **ë‹¤ìŒ ë¬¸ì œë“¤ì€ í”„ë¡œë•ì…˜ ëŸ°ì¹­ ì „ ë°˜ë“œì‹œ í•´ê²°í•´ì•¼ í•©ë‹ˆë‹¤.**

### ğŸ”´ Critical #1: SQLite3ì˜ ë™ì‹œì„± í•œê³„

**ë¬¸ì œ ì„¤ëª…**:
- SQLite3ëŠ” íŒŒì¼ ê¸°ë°˜ DBë¡œ **Write ì—°ì‚° ì‹œ ì „ì²´ DB Lock** ë°œìƒ
- 10ëª…ì´ ë™ì‹œì— ì…ì°° ì‹œ ìˆœì°¨ ì²˜ë¦¬ë˜ì–´ ì§€ì—° ë°œìƒ
- `select_for_update()`ê°€ PostgreSQLì²˜ëŸ¼ ì‘ë™í•˜ì§€ ì•ŠìŒ

**ì‹œë‚˜ë¦¬ì˜¤**:
```
ì‚¬ìš©ì A â†’ ì…ì°° ìš”ì²­ â”€â”
ì‚¬ìš©ì B â†’ ì…ì°° ìš”ì²­ â”€â”€â”¼â”€â†’ [SQLite Lock] â†’ A ì²˜ë¦¬ â†’ B ì²˜ë¦¬ â†’ C ì²˜ë¦¬...
ì‚¬ìš©ì C â†’ ì…ì°° ìš”ì²­ â”€â”˜
                           â†‘ ë³‘ëª© ì§€ì  (ìµœëŒ€ 1-2ì´ˆ ì§€ì—°)
```

**í•´ê²°ë°©ì•ˆ**: PostgreSQL ì „í™˜ (ìƒë‹¨ 0ë²ˆ í•­ëª© ì°¸ì¡°)

---

### ğŸ”´ Critical #2: ì„¸ì…˜ ì €ì¥ì†Œ ë¯¸ë¶„ë¦¬

**ë¬¸ì œ ì„¤ëª…**:
- í˜„ì¬ Django ê¸°ë³¸ ì„¸ì…˜ ì €ì¥ì†ŒëŠ” DB ì‚¬ìš©
- ë§¤ ìš”ì²­ë§ˆë‹¤ DB ì¿¼ë¦¬ ë°œìƒ â†’ ë™ì‹œ ì‚¬ìš©ì ì¦ê°€ ì‹œ ë¶€í•˜

**í˜„ì¬ ì„¤ì •**:
```python
# settings.py - ëª…ì‹œì  ì„¤ì • ì—†ìŒ â†’ ê¸°ë³¸ê°’ DB ì„¸ì…˜ ì‚¬ìš©
SESSION_ENGINE = 'django.contrib.sessions.backends.db'  # ê¸°ë³¸ê°’
```

**í•´ê²°ë°©ì•ˆ**:
```python
# âœ… Redis ì„¸ì…˜ ì €ì¥ì†Œ ì‚¬ìš©
SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
SESSION_CACHE_ALIAS = 'default'

CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': 'redis://redis:6379/1',  # Channelsì™€ ë‹¤ë¥¸ DB ì‚¬ìš©
    }
}
```

---

### ğŸ”´ Critical #3: WebSocket ì—°ê²° ê´€ë¦¬ ë¶€ì¬

**ë¬¸ì œ ì„¤ëª…**:
- ê²½ë§¤ ì¢…ë£Œ í›„ì—ë„ WebSocket ì—°ê²°ì´ ëª…ì‹œì ìœ¼ë¡œ ì¢…ë£Œë˜ì§€ ì•ŠìŒ
- í´ë¼ì´ì–¸íŠ¸ ë¹„ì •ìƒ ì¢…ë£Œ ì‹œ ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ìœ 

**í˜„ì¬ Consumer ì½”ë“œ**:
```python
# auctions/consumers.py
async def disconnect(self, close_code):
    await self.channel_layer.group_discard(
        self.room_group_name,
        self.channel_name
    )
    # âŒ ê·¸ë£¹ì—ì„œë§Œ ì œê±°, ì¶”ê°€ ì •ë¦¬ ë¡œì§ ì—†ìŒ
```

**ê°œì„  ë°©í–¥**:
```python
# âœ… ê°œì„ ëœ disconnect
async def disconnect(self, close_code):
    await self.channel_layer.group_discard(
        self.room_group_name,
        self.channel_name
    )
    
    # ë¡œê¹… ì¶”ê°€
    import logging
    logger = logging.getLogger(__name__)
    logger.info(f"WebSocket ì—°ê²° ì¢…ë£Œ: auction_{self.auction_id}, code={close_code}")
    
    # ì—°ê²° í†µê³„ ì—…ë°ì´íŠ¸ (Redis ì‚¬ìš© ì‹œ)
    # await self.update_connection_stats(-1)
```

---

### ğŸ”´ Critical #4: N+1 ì¿¼ë¦¬ ë¬¸ì œ (ì„±ëŠ¥)

**ìœ„ì¹˜**: `auctions/views.py` - `auction_list()`

**í˜„ì¬ ìƒíƒœ**:
```python
auctions = Auction.objects.filter(status__in=['ACTIVE', 'WAITING'])
# âŒ í…œí”Œë¦¿ì—ì„œ auction.seller, auction.category ì ‘ê·¼ ì‹œ ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒ
```

**í•´ê²°ë°©ì•ˆ**:
```python
# âœ… select_related / prefetch_related ì‚¬ìš©
auctions = Auction.objects.filter(
    status__in=['ACTIVE', 'WAITING']
).select_related(
    'seller', 'category', 'region'
).prefetch_related(
    'bids', 'watchers'
).order_by('-created_at')
```

**ì˜ˆìƒ íš¨ê³¼**:
```
ë³€ê²½ ì „: 10ê°œ ê²½ë§¤ ì¡°íšŒ ì‹œ ì•½ 30-40ê°œ ì¿¼ë¦¬
ë³€ê²½ í›„: 10ê°œ ê²½ë§¤ ì¡°íšŒ ì‹œ ì•½ 3-5ê°œ ì¿¼ë¦¬
```

---

### âš ï¸ Warning #5: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë³´ì•ˆ

**ë¬¸ì œ ì„¤ëª…**:
- ì—…ë¡œë“œ íŒŒì¼ í™•ì¥ì/MIME íƒ€ì… ê²€ì¦ ì—†ìŒ
- ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì—…ë¡œë“œ ê°€ëŠ¥ì„±

**í˜„ì¬ ëª¨ë¸**:
```python
image = models.ImageField(upload_to='auction_images/', blank=True, null=True)
# âŒ íŒŒì¼ í¬ê¸°, íƒ€ì… ê²€ì¦ ì—†ìŒ
```

**í•´ê²°ë°©ì•ˆ**:
```python
# âœ… ì»¤ìŠ¤í…€ Validator ì¶”ê°€
from django.core.validators import FileExtensionValidator
from django.core.exceptions import ValidationError

def validate_image_size(value):
    max_size = 5 * 1024 * 1024  # 5MB
    if value.size > max_size:
        raise ValidationError("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.")

image = models.ImageField(
    upload_to='auction_images/',
    blank=True,
    null=True,
    validators=[
        FileExtensionValidator(allowed_extensions=['jpg', 'jpeg', 'png', 'webp']),
        validate_image_size,
    ]
)
```

---

### âš ï¸ Warning #6: í™˜ë¶ˆ ë¡œì§ì˜ Decimal ì—°ì‚° ëˆ„ë½

**ìœ„ì¹˜**: `auctions/services.py`

**ë¬¸ì œ ì„¤ëª…**:
- Wallet ëª¨ë¸ì€ `DecimalField` ì‚¬ìš©
- ì—°ì‚° ì‹œ `Decimal` íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ì§€ ì•Šìœ¼ë©´ ì •ë°€ë„ ì†ì‹¤ ê°€ëŠ¥

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
wallet.balance -= amount  # amountê°€ intë©´ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
```

**í•´ê²°ë°©ì•ˆ**:
```python
# âœ… ëª…ì‹œì  Decimal ë³€í™˜
from decimal import Decimal

wallet.balance -= Decimal(str(amount))
wallet.locked_balance += Decimal(str(amount))
```

---

## 4. ë³´ì•ˆ ì·¨ì•½ì  ë° ê°œì„  ë°©ì•ˆ

### ğŸ”´ Security #1: SECRET_KEY í•˜ë“œì½”ë”©

**ìœ„ì¹˜**: `config/settings.py` Line 23

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ (ì¹˜ëª…ì )
SECRET_KEY = 'django-insecure-%y^ksn&nm==9o!u-@fdd@^v*@tgi^t54_!=aza)i13yb$5l*=q'
```

**ìˆ˜ì • ì½”ë“œ**:
```python
# âœ… í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©
import os

SECRET_KEY = os.environ.get('DJANGO_SECRET_KEY')

if not SECRET_KEY:
    if DEBUG:
        SECRET_KEY = 'dev-only-insecure-key-do-not-use-in-production'
    else:
        raise ValueError("DJANGO_SECRET_KEY í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
```

---

### ğŸ”´ Security #2: DEBUG=True í”„ë¡œë•ì…˜ ë…¸ì¶œ ìœ„í—˜

**ìœ„ì¹˜**: `config/settings.py` Line 26

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
DEBUG = True  # í”„ë¡œë•ì…˜ì—ì„œëŠ” ì—ëŸ¬ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ë…¸ì¶œ
```

**ìˆ˜ì • ì½”ë“œ**:
```python
# âœ… í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
DEBUG = os.environ.get('DJANGO_DEBUG', 'False').lower() == 'true'
```

---

### ğŸ”´ Security #3: ALLOWED_HOSTS ì™€ì¼ë“œì¹´ë“œ

**ìœ„ì¹˜**: `config/settings.py` Line 28

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
ALLOWED_HOSTS = ['*']  # ëª¨ë“  í˜¸ìŠ¤íŠ¸ í—ˆìš© â†’ Host Header Attack ì·¨ì•½
```

**ìˆ˜ì • ì½”ë“œ**:
```python
# âœ… ëª…ì‹œì  í˜¸ìŠ¤íŠ¸ ì§€ì •
ALLOWED_HOSTS = os.environ.get('ALLOWED_HOSTS', 'localhost,127.0.0.1').split(',')

# í”„ë¡œë•ì…˜ ì˜ˆì‹œ
# ALLOWED_HOSTS = ['neighborbid.com', 'www.neighborbid.com', 'api.neighborbid.com']
```

---

### ğŸ”´ Security #4: CSRF ì‹ ë¢° ì¶œì²˜ ì™€ì¼ë“œì¹´ë“œ

**ìœ„ì¹˜**: `config/settings.py` Line 34-39

```python
# ğŸ”´ í˜„ì¬ ì½”ë“œ
CSRF_TRUSTED_ORIGINS = [
    'http://localhost:8000',
    'http://127.0.0.1:8000',
    'http://*',  # âŒ ëª¨ë“  HTTP ì¶œì²˜ í—ˆìš©
]
```

**ìˆ˜ì • ì½”ë“œ**:
```python
# âœ… ëª…ì‹œì  ì¶œì²˜ ì§€ì •
CSRF_TRUSTED_ORIGINS = os.environ.get(
    'CSRF_TRUSTED_ORIGINS',
    'http://localhost:8000,http://127.0.0.1:8000'
).split(',')
```

---

### âš ï¸ Security #5: ë³´ì•ˆ í—¤ë” ë¯¸ì„¤ì •

**ì¶”ê°€ í•„ìš” ì„¤ì •**:
```python
# config/settings.pyì— ì¶”ê°€

# HTTPS ê°•ì œ (í”„ë¡œë•ì…˜)
if not DEBUG:
    SECURE_SSL_REDIRECT = True
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    
    # HSTS ì„¤ì •
    SECURE_HSTS_SECONDS = 31536000  # 1ë…„
    SECURE_HSTS_INCLUDE_SUBDOMAINS = True
    SECURE_HSTS_PRELOAD = True
    
    # ì¿ í‚¤ ë³´ì•ˆ
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
    SESSION_COOKIE_HTTPONLY = True

# XSS ë°©ì§€
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True

# Clickjacking ë°©ì§€
X_FRAME_OPTIONS = 'DENY'
```

---

### âš ï¸ Security #6: WebSocket ì¸ì¦ ê°•í™” í•„ìš”

**í˜„ì¬ ìƒíƒœ**:
```python
# config/asgi.py
"websocket": AuthMiddlewareStack(...)  # Django ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ë§Œ
```

**ê°œì„  ë°©í–¥**:
```python
# âœ… í† í° ê¸°ë°˜ ì¸ì¦ + ê²½ë§¤ ì ‘ê·¼ ê¶Œí•œ í™•ì¸ ì¶”ê°€
# custom_middleware.py (ì‹ ê·œ)

class AuctionAccessMiddleware:
    async def __call__(self, scope, receive, send):
        # ê²½ë§¤ ìƒíƒœ í™•ì¸
        auction_id = scope['url_route']['kwargs'].get('auction_id')
        if auction_id:
            auction = await self.get_auction(auction_id)
            if not auction or auction.status != 'ACTIVE':
                await send({
                    'type': 'websocket.close',
                    'code': 4000
                })
                return
        return await self.app(scope, receive, send)
```

---

## 5. ìƒì„¸ êµ¬í˜„ ì¼ì •í‘œ

> **ëª©í‘œ**: í”„ë¡œë•ì…˜ ëŸ°ì¹­ì„ ìœ„í•œ ë‹¨ê³„ë³„ ê°œì„  ì‘ì—…  
> **ê¸°ê°„**: 3ì£¼ (Week 1 ~ Week 3)  
> **ê¸°ë°˜**: í˜„ì¬ Django + Channels + Redis + SQLite3 êµ¬ì¡°

---

### ğŸ“‹ ë‚ ì§œë³„ ìƒì„¸ ì¼ì •

| Week | Day | ë‚ ì§œ | ë‹¨ê³„ | ì‘ì—… ë‚´ìš© | í•µì‹¬ ê¸°ìˆ  | ì‚°ì¶œë¬¼ | ìƒíƒœ |
|:----:|:---:|:----:|:----:|----------|----------|--------|:----:|
| **1** | 1 | 01/13 | ë²„ê·¸ìˆ˜ì • | `winner` í•„ë“œ ì¶”ê°€ ë° ë²„ê·¸ ìˆ˜ì • | Django ORM | `auctions/models.py` ìˆ˜ì •, ë§ˆì´ê·¸ë ˆì´ì…˜ | â¬œ |
| **1** | 1 | 01/13 | ë³´ì•ˆ | SECRET_KEY, DEBUG í™˜ê²½ë³€ìˆ˜í™” | python-dotenv | `config/settings.py` ìˆ˜ì •, `.env` íŒŒì¼ ìƒì„± | â¬œ |
| **1** | 2 | 01/14 | ë²„ê·¸ìˆ˜ì • | `charge_wallet()` íŠ¸ëœì­ì…˜ ì ìš© | DB Transaction | `auctions/views.py` ìˆ˜ì • | â¬œ |
| **1** | 2 | 01/14 | ë²„ê·¸ìˆ˜ì • | ì…ë ¥ê°’ ê²€ì¦ ê°•í™” (amount, bid) | Form Validation | `auctions/views.py`, `services.py` ìˆ˜ì • | â¬œ |
| **1** | 3 | 01/15 | DBì „í™˜ | PostgreSQL í™˜ê²½ êµ¬ì¶• | Docker, PostgreSQL 15 | `docker-compose.yml` ìˆ˜ì •, ì—°ê²° í…ŒìŠ¤íŠ¸ | â¬œ |
| **1** | 4 | 01/16 | DBì „í™˜ | settings.py DB ì„¤ì • ë³€ê²½ | psycopg2-binary | `config/settings.py` DATABASES ìˆ˜ì • | â¬œ |
| **1** | 5 | 01/17 | DBì „í™˜ | ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (SQLite â†’ PostgreSQL) | dumpdata/loaddata | ë°ì´í„° ë°±ì—… ë° ë³µì› ì™„ë£Œ | â¬œ |
| **1** | 6 | 01/18 | DBì „í™˜ | ì¸ë±ìŠ¤ ìµœì í™” | PostgreSQL Index | `current_price`, `status`, `end_time` ì¸ë±ìŠ¤ | â¬œ |
| **1** | 7 | 01/19 | í…ŒìŠ¤íŠ¸ | ë™ì‹œì„± ë° ì…ì°° í…ŒìŠ¤íŠ¸ | TransactionTestCase | ë™ì‹œ ì…ì°° í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸ | â¬œ |
| **2** | 1 | 01/20 | ë³´ì•ˆ | ALLOWED_HOSTS, CSRF ì„¤ì • ê°•í™” | Django Security | `config/settings.py` ë³´ì•ˆ ì„¤ì • | â¬œ |
| **2** | 2 | 01/21 | ë³´ì•ˆ | ë³´ì•ˆ í—¤ë” ì„¤ì • (HSTS, XSS, Clickjacking) | Security Headers | í”„ë¡œë•ì…˜ ë³´ì•ˆ í—¤ë” ì ìš© | â¬œ |
| **2** | 3 | 01/22 | ì„¸ì…˜ | Redis ì„¸ì…˜ ì €ì¥ì†Œ ì „í™˜ | django-redis | SESSION_ENGINE ë³€ê²½, í…ŒìŠ¤íŠ¸ | â¬œ |
| **2** | 4 | 01/23 | ì„±ëŠ¥ | N+1 ì¿¼ë¦¬ ìµœì í™” | select_related, prefetch_related | `auctions/views.py` ì¿¼ë¦¬ ìµœì í™” | â¬œ |
| **2** | 5 | 01/24 | ì—…ë¡œë“œ | ì´ë¯¸ì§€ ì—…ë¡œë“œ ê²€ì¦ ì¶”ê°€ | FileValidator | `auctions/models.py` Validator ì¶”ê°€ | â¬œ |
| **2** | 6 | 01/25 | ë¡œê¹… | ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶• | Python logging | `config/settings.py` LOGGING ì„¤ì • | â¬œ |
| **2** | 7 | 01/26 | ì™„ì„± | ë¯¸ì™„ì„± ë¡œì§ ë³´ì™„ (bid_unit ê²€ì¦) | Business Logic | `auctions/services.py` ê²€ì¦ ë¡œì§ ê°•í™” | â¬œ |
| **3** | 1 | 01/27 | ìë™í™” | Celery + Redis í™˜ê²½ êµ¬ì¶• | Celery, Redis | `config/celery.py`, docker-compose ìˆ˜ì • | â¬œ |
| **3** | 2 | 01/28 | ìë™í™” | ê²½ë§¤ ìë™ ì¢…ë£Œ Task êµ¬í˜„ | Celery Beat | `auctions/tasks.py` ìŠ¤ì¼€ì¤„ëŸ¬ | â¬œ |
| **3** | 3 | 01/29 | ì•Œë¦¼ | Notification ì‹œìŠ¤í…œ ì—°ë™ | Django Signals | `auctions/services.py` ì•Œë¦¼ ë¡œì§ ì¶”ê°€ | â¬œ |
| **3** | 4 | 01/30 | ìºì‹œ | ê²½ë§¤ ëª©ë¡ ìºì‹± ì ìš© | Redis Cache | `auctions/views.py` ìºì‹œ ë°ì½”ë ˆì´í„° | â¬œ |
| **3** | 5 | 01/31 | í…ŒìŠ¤íŠ¸ | E2E í…ŒìŠ¤íŠ¸ ë° ë¶€í•˜ í…ŒìŠ¤íŠ¸ | Locust, Selenium | ë™ì‹œ 10ëª… í…ŒìŠ¤íŠ¸ í†µê³¼ | â¬œ |

### ğŸ“Š ì£¼ì°¨ë³„ ìš”ì•½

| Week | ì£¼ì œ | í•µì‹¬ ê¸°ìˆ  | ìµœì¢… ì‚°ì¶œë¬¼ |
|:----:|------|----------|------------|
| **1** | ë²„ê·¸ ìˆ˜ì • + PostgreSQL ì „í™˜ | PostgreSQL, Transaction, Django ORM | DB ì „í™˜ ì™„ë£Œ, í•µì‹¬ ë²„ê·¸ ìˆ˜ì • |
| **2** | ë³´ì•ˆ ê°•í™” + ì„±ëŠ¥ ìµœì í™” | Security Headers, Redis Session, Query Optimization | í”„ë¡œë•ì…˜ ë³´ì•ˆ ìˆ˜ì¤€ ë‹¬ì„± |
| **3** | ìë™í™” + ì™„ì„±ë„ í–¥ìƒ | Celery Beat, Notification, Cache | ëŸ°ì¹­ ì¤€ë¹„ ì™„ë£Œ |

### ğŸ¯ ì§„í–‰ ìƒíƒœ ë²”ë¡€
- â¬œ ë¯¸ì°©ìˆ˜
- ğŸ”„ ì§„í–‰ ì¤‘
- âœ… ì™„ë£Œ
- âŒ ë³´ë¥˜/ì·¨ì†Œ

---

# Week 1: ë²„ê·¸ ìˆ˜ì • + PostgreSQL ì „í™˜

## 1-1. ë²„ê·¸ ìˆ˜ì • (Day 1~2)

### ğŸ“Œ ëª©í‘œ
- ì¹˜ëª…ì  ë²„ê·¸ 4ê±´ ì¦‰ì‹œ ìˆ˜ì •
- í”„ë¡œë•ì…˜ ë°°í¬ ì°¨ë‹¨ ìš”ì†Œ ì œê±°

### ğŸ—ï¸ ì‘ì—… íë¦„
```
[Bug #1] winner í•„ë“œ ì¶”ê°€
    â†“
[Bug #2] charge_wallet íŠ¸ëœì­ì…˜
    â†“
[Bug #3] ì…ë ¥ê°’ ê²€ì¦ ê°•í™”
    â†“
[Bug #4] on_commit í´ë¡œì € ìˆ˜ì •
```

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 1 (01/13): winner í•„ë“œ + ë³´ì•ˆ ì„¤ì •

- [ ] `auctions/models.py`ì— `winner` í•„ë“œ ì¶”ê°€
  ```python
  winner = models.ForeignKey(
      settings.AUTH_USER_MODEL,
      on_delete=models.SET_NULL,
      null=True, blank=True,
      related_name='won_auctions'
  )
  ```
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
  ```bash
  python manage.py makemigrations
  python manage.py migrate
  ```
- [ ] `.env` íŒŒì¼ ìƒì„±
  ```env
  DJANGO_SECRET_KEY=your-secure-key-here
  DJANGO_DEBUG=True
  ALLOWED_HOSTS=localhost,127.0.0.1
  ```
- [ ] `config/settings.py` í™˜ê²½ë³€ìˆ˜ ì ìš©
  ```python
  import os
  from dotenv import load_dotenv
  load_dotenv()
  
  SECRET_KEY = os.environ.get('DJANGO_SECRET_KEY')
  DEBUG = os.environ.get('DJANGO_DEBUG', 'False').lower() == 'true'
  ```

#### Day 2 (01/14): íŠ¸ëœì­ì…˜ + ê²€ì¦ ê°•í™”

- [ ] `charge_wallet()` í•¨ìˆ˜ì— `transaction.atomic()` ì ìš©
- [ ] `auction_detail()` POST ì²˜ë¦¬ì— ì…ë ¥ê°’ ê²€ì¦ ì¶”ê°€
- [ ] `bid_unit` ë°°ìˆ˜ ê²€ì¦ ë¡œì§ ì¶”ê°€
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í™•ì¸

---

## 1-2. PostgreSQL ì „í™˜ (Day 3~7)

### ğŸ“Œ ëª©í‘œ
- SQLite3 â†’ PostgreSQL ì™„ì „ ì „í™˜
- `select_for_update()` ì •ìƒ ë™ì‘ í™•ì¸
- ë™ì‹œì„± í…ŒìŠ¤íŠ¸ í†µê³¼

### ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë³€ê²½
```
[í˜„ì¬]
Django â”€â†’ SQLite3 (íŒŒì¼ ê¸°ë°˜, Write Lock)

[ë³€ê²½ í›„]
Django â”€â†’ PostgreSQL (Row Lock, MVCC)
            â†‘
        Docker Container
```

### ğŸ“ íŒŒì¼ ë³€ê²½ ì‚¬í•­
```
NeighborBid_Auction/
â”œâ”€â”€ docker-compose.yml    # [ìˆ˜ì •] PostgreSQL ì„œë¹„ìŠ¤ ì¶”ê°€
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py       # [ìˆ˜ì •] DATABASES ì„¤ì • ë³€ê²½
â”œâ”€â”€ requirements.txt      # [ìˆ˜ì •] psycopg2-binary ì¶”ê°€
â””â”€â”€ .env                  # [ì‹ ê·œ] DB ì ‘ì† ì •ë³´
```

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 3 (01/15): PostgreSQL í™˜ê²½ êµ¬ì¶•

- [ ] `docker-compose.yml`ì— PostgreSQL ì¶”ê°€
  ```yaml
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: neighborbid
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 5s
      timeout: 5s
      retries: 5
  ```
- [ ] `.env`ì— DB ì •ë³´ ì¶”ê°€
  ```env
  DB_PASSWORD=your-secure-password
  DB_HOST=postgres
  DB_NAME=neighborbid
  ```
- [ ] Docker Compose ì¬ì‹œì‘ ë° PostgreSQL ì—°ê²° í…ŒìŠ¤íŠ¸
  ```bash
  docker compose up -d postgres
  docker compose exec postgres psql -U postgres -d neighborbid
  ```

#### Day 4 (01/16): settings.py ë³€ê²½

- [ ] `requirements.txt`ì— ì¶”ê°€
  ```
  psycopg2-binary==2.9.9
  python-dotenv==1.0.0
  ```
- [ ] `config/settings.py` DATABASES ë³€ê²½
  ```python
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.postgresql',
          'NAME': os.environ.get('DB_NAME', 'neighborbid'),
          'USER': os.environ.get('DB_USER', 'postgres'),
          'PASSWORD': os.environ.get('DB_PASSWORD'),
          'HOST': os.environ.get('DB_HOST', 'postgres'),
          'PORT': os.environ.get('DB_PORT', '5432'),
          'CONN_MAX_AGE': 60,
      }
  }
  ```

#### Day 5 (01/17): ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

- [ ] SQLite3 ë°ì´í„° ë°±ì—…
  ```bash
  python manage.py dumpdata --exclude auth.permission --exclude contenttypes > backup.json
  ```
- [ ] PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
  ```bash
  python manage.py migrate
  ```
- [ ] ë°ì´í„° ë³µì›
  ```bash
  python manage.py loaddata backup.json
  ```

#### Day 6 (01/18): ì¸ë±ìŠ¤ ìµœì í™”

- [ ] ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
  ```python
  # auctions/migrations/0002_add_indexes.py
  from django.db import migrations, models
  
  class Migration(migrations.Migration):
      dependencies = [('auctions', '0001_initial')]
      operations = [
          migrations.AddIndex(
              model_name='auction',
              index=models.Index(fields=['status', 'end_time'], name='auction_status_end_idx'),
          ),
          migrations.AddIndex(
              model_name='auction',
              index=models.Index(fields=['-current_price'], name='auction_price_idx'),
          ),
      ]
  ```

#### Day 7 (01/19): ë™ì‹œì„± í…ŒìŠ¤íŠ¸

- [ ] ë™ì‹œ ì…ì°° í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
  ```python
  from django.test import TransactionTestCase
  import threading
  
  class ConcurrencyTestCase(TransactionTestCase):
      def test_double_spending_prevention(self):
          # ë™ì‹œ ì…ì°° í…ŒìŠ¤íŠ¸
          pass
  ```
- [ ] `select_for_update()` ë™ì‘ í™•ì¸
- [ ] ì”ì•¡ ë¬´ê²°ì„± ê²€ì¦

### ğŸ§ª ê²€ì¦ í•­ëª©
- [ ] PostgreSQL ì»¨í…Œì´ë„ˆ ì •ìƒ ì‹¤í–‰
- [ ] Django Admin ì ‘ì† í™•ì¸
- [ ] ê²½ë§¤ ëª©ë¡/ìƒì„¸ í˜ì´ì§€ ì •ìƒ ë™ì‘
- [ ] ì…ì°° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë™ì‹œ ì…ì°° ì‹œ ë°ì´í„° ë¬´ê²°ì„± í™•ì¸

---

# Week 2: ë³´ì•ˆ ê°•í™” + ì„±ëŠ¥ ìµœì í™”

## 2-1. ë³´ì•ˆ ê°•í™” (Day 1~3)

### ğŸ“Œ ëª©í‘œ
- í”„ë¡œë•ì…˜ ìˆ˜ì¤€ ë³´ì•ˆ ì„¤ì • ì™„ë£Œ
- OWASP ê¸°ë³¸ ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 1 (01/20): í˜¸ìŠ¤íŠ¸ ë° CSRF ì„¤ì •

- [ ] `ALLOWED_HOSTS` ëª…ì‹œì  ì„¤ì •
- [ ] `CSRF_TRUSTED_ORIGINS` ì •ë¦¬
- [ ] ì™€ì¼ë“œì¹´ë“œ(`*`) ì„¤ì • ì œê±°

#### Day 2 (01/21): ë³´ì•ˆ í—¤ë” ì„¤ì •

- [ ] `config/settings.py`ì— ë³´ì•ˆ ì„¤ì • ì¶”ê°€
  ```python
  # í”„ë¡œë•ì…˜ ì „ìš© ë³´ì•ˆ ì„¤ì •
  if not DEBUG:
      SECURE_SSL_REDIRECT = True
      SECURE_HSTS_SECONDS = 31536000
      SECURE_HSTS_INCLUDE_SUBDOMAINS = True
      SESSION_COOKIE_SECURE = True
      CSRF_COOKIE_SECURE = True
  
  # ê³µí†µ ë³´ì•ˆ ì„¤ì •
  SECURE_BROWSER_XSS_FILTER = True
  SECURE_CONTENT_TYPE_NOSNIFF = True
  X_FRAME_OPTIONS = 'DENY'
  ```

#### Day 3 (01/22): Redis ì„¸ì…˜ ì „í™˜

- [ ] `django-redis` ì„¤ì¹˜
  ```
  django-redis==5.4.0
  ```
- [ ] ì„¸ì…˜ ì €ì¥ì†Œ ë³€ê²½
  ```python
  SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
  SESSION_CACHE_ALIAS = 'default'
  
  CACHES = {
      'default': {
          'BACKEND': 'django.core.cache.backends.redis.RedisCache',
          'LOCATION': 'redis://redis:6379/1',
      }
  }
  ```

---

## 2-2. ì„±ëŠ¥ ìµœì í™” (Day 4~7)

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 4 (01/23): N+1 ì¿¼ë¦¬ ìµœì í™”

- [ ] `auction_list()` ì¿¼ë¦¬ ìµœì í™”
  ```python
  auctions = Auction.objects.filter(
      status__in=['ACTIVE', 'WAITING']
  ).select_related(
      'seller', 'category', 'region'
  ).prefetch_related('bids')
  ```
- [ ] Django Debug Toolbarë¡œ ì¿¼ë¦¬ ìˆ˜ í™•ì¸

#### Day 5 (01/24): ì´ë¯¸ì§€ ì—…ë¡œë“œ ê²€ì¦

- [ ] `validate_image_size()` í•¨ìˆ˜ ì‘ì„±
- [ ] `FileExtensionValidator` ì ìš©
- [ ] 5MB íŒŒì¼ í¬ê¸° ì œí•œ ì„¤ì •

#### Day 6 (01/25): ë¡œê¹… ì‹œìŠ¤í…œ

- [ ] `config/settings.py`ì— LOGGING ì„¤ì •
  ```python
  LOGGING = {
      'version': 1,
      'handlers': {
          'file': {
              'class': 'logging.FileHandler',
              'filename': 'logs/django.log',
          },
      },
      'loggers': {
          'django': {'handlers': ['file'], 'level': 'WARNING'},
          'auctions': {'handlers': ['file'], 'level': 'INFO'},
      },
  }
  ```

#### Day 7 (01/26): ë¯¸ì™„ì„± ë¡œì§ ë³´ì™„

- [ ] `bid_unit` ë°°ìˆ˜ ê²€ì¦ êµ¬í˜„
- [ ] ë¦¬ë·° ì‹œìŠ¤í…œ `winner` í•„ë“œ ì—°ë™
- [ ] Decimal ì—°ì‚° ëª…ì‹œì  ë³€í™˜ ì ìš©

---

# Week 3: ìë™í™” + ì™„ì„±ë„ í–¥ìƒ

## 3-1. Celery ìŠ¤ì¼€ì¤„ëŸ¬ (Day 1~2)

### ğŸ“Œ ëª©í‘œ
- ê²½ë§¤ ìë™ ì¢…ë£Œ ì‹œìŠ¤í…œ êµ¬ì¶•
- ì£¼ê¸°ì  Task ì‹¤í–‰ í™˜ê²½ ì™„ì„±

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 1 (01/27): Celery í™˜ê²½ êµ¬ì¶•

- [ ] `requirements.txt`ì— ì¶”ê°€
  ```
  celery==5.3.6
  django-celery-beat==2.5.0
  ```
- [ ] `config/celery.py` ìƒì„±
  ```python
  from celery import Celery
  
  app = Celery('neighborbid')
  app.config_from_object('django.conf:settings', namespace='CELERY')
  app.autodiscover_tasks()
  ```
- [ ] `docker-compose.yml`ì— Celery worker/beat ì¶”ê°€

#### Day 2 (01/28): ê²½ë§¤ ìë™ ì¢…ë£Œ Task

- [ ] `auctions/tasks.py` ìƒì„±
  ```python
  from celery import shared_task
  
  @shared_task
  def check_expired_auctions():
      # ì¢…ë£Œ ì‹œê°„ ì§€ë‚œ ê²½ë§¤ ì²˜ë¦¬
      pass
  ```
- [ ] Celery Beat ìŠ¤ì¼€ì¤„ ì„¤ì • (1ë¶„ ê°„ê²©)

---

## 3-2. ì•Œë¦¼ + ìºì‹œ (Day 3~5)

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Day 3 (01/29): Notification ì—°ë™

- [ ] ì…ì°° ì„±ê³µ ì‹œ íŒë§¤ì ì•Œë¦¼
- [ ] ìƒìœ„ ì…ì°° ë°œìƒ ì‹œ ì´ì „ ì…ì°°ì ì•Œë¦¼
- [ ] ê²½ë§¤ ì¢…ë£Œ ì‹œ ë‚™ì°°ì/ìœ ì°° ì•Œë¦¼

#### Day 4 (01/30): ìºì‹œ ì ìš©

- [ ] ê²½ë§¤ ëª©ë¡ ìºì‹± (TTL: 30ì´ˆ)
- [ ] ìºì‹œ ë¬´íš¨í™” ë¡œì§ (ìƒˆ ì…ì°° ì‹œ)

#### Day 5 (01/31): ìµœì¢… í…ŒìŠ¤íŠ¸

- [ ] E2E í…ŒìŠ¤íŠ¸ (ê²½ë§¤ ìƒì„± â†’ ì…ì°° â†’ ì¢…ë£Œ)
- [ ] ë™ì‹œ 10ëª… ë¶€í•˜ í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ë™ì‘ í™•ì¸

---

## ğŸ“Š í˜„ì¬ ì½”ë“œ í’ˆì§ˆ ì ìˆ˜

| ì¹´í…Œê³ ë¦¬ | í˜„ì¬ ì ìˆ˜ | ëª©í‘œ ì ìˆ˜ | í‰ê°€ |
|----------|:--------:|:--------:|------|
| **ê¸°ëŠ¥ ì™„ì„±ë„** | 7/10 | 9/10 | ìë™í™” ì¶”ê°€ í›„ ë‹¬ì„± |
| **ì½”ë“œ í’ˆì§ˆ** | 7/10 | 8/10 | ë¦¬íŒ©í† ë§ í›„ ë‹¬ì„± |
| **ë³´ì•ˆ** | 3/10 | 8/10 | Week 2 ì™„ë£Œ í›„ ë‹¬ì„± |
| **ì„±ëŠ¥** | 5/10 | 8/10 | PostgreSQL + ìºì‹œ í›„ ë‹¬ì„± |
| **í™•ì¥ì„±** | 6/10 | 8/10 | Celery êµ¬ì¶• í›„ ë‹¬ì„± |
| **í…ŒìŠ¤íŠ¸** | 2/10 | 5/10 | í•µì‹¬ í…ŒìŠ¤íŠ¸ ì¶”ê°€ í›„ ë‹¬ì„± |

**í˜„ì¬ ì¢…í•©: 5/10** â†’ **ëª©í‘œ ì¢…í•©: 8/10** (í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ)

> [!TIP]
> **3ì£¼ í›„ ê¸°ëŒ€ íš¨ê³¼**
> - 10ëª… ë™ì‹œ ì‚¬ìš©ì ì•ˆì •ì  ì²˜ë¦¬
> - í”„ë¡œë•ì…˜ ë³´ì•ˆ ìˆ˜ì¤€ ë‹¬ì„±
> - ê²½ë§¤ ìë™ ì¢…ë£Œë¡œ ìš´ì˜ ë¶€ë‹´ ê°ì†Œ
> - ì‹¤ì œ ì„œë¹„ìŠ¤ ëŸ°ì¹­ ê°€ëŠ¥ ìƒíƒœ

---

**ì‘ì„±ì¼**: 2026-01-12  
**ë¶„ì„ ëŒ€ìƒ ë²„ì „**: Django 5.2, Channels, Redis, SQLite3  
**ë‹¤ìŒ ë‹¨ê³„**: Week 1 Day 1 (01/13) ì‘ì—… ì‹œì‘
